generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  PARTNER
}

enum LeadStatus {
  NEW
  MATCHED
  INTRO_SENT
  CLOSED
}

enum IntroStatus {
  NEW
  ACCEPTED
  DECLINED
}

enum BudgetTier {
  under_5k
  five_10k    @map("5_10k")
  ten_30k     @map("10_30k")
  thirty_plus @map("30_plus")
}

enum PartnerStatus {
  PENDING
  APPROVED
  REJECTED
}

enum CommissionScenario {
  direct_referral
  direct_sale_by_lead_holder
  reactivation
  follow_on
  exception_payment_risk
}

model User {
  id           String         @id @default(cuid())
  email        String         @unique
  passwordHash String
  role         Role
  createdAt    DateTime       @default(now())
  partner      PartnerProfile?
}

model PartnerProfile {
  id               String           @id @default(cuid())
  userId           String           @unique
  slug             String           @unique
  companyName      String
  tagline          String
  description      String
  websiteUrl       String
  regions          String[]
  languages        String[]
  categories       String[]
  tags             String[]
  responseSlaHours Int
  status           PartnerStatus   @default(PENDING)
  isVerified       Boolean          @default(false)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  user             User             @relation(fields: [userId], references: [id])
  packages         PartnerPackage[]
  cases            CaseStudy[]
  intros           Intro[]
}

model PartnerPackage {
  id            String         @id @default(cuid())
  partnerId     String
  name          String
  priceFromUsd  Int
  timeline      String
  deliverables  String[]
  partner       PartnerProfile @relation(fields: [partnerId], references: [id])
}

model CaseStudy {
  id         String         @id @default(cuid())
  partnerId  String
  title      String
  industry   String
  problem    String
  solution   String
  outcomes   String
  isPublic   Boolean        @default(true)
  createdAt  DateTime       @default(now())
  partner    PartnerProfile @relation(fields: [partnerId], references: [id])
}

model LeadRequest {
  id             String      @id @default(cuid())
  requesterName  String
  requesterEmail String
  companyName    String
  message        String
  budget         BudgetTier
  region         String
  categories     String[]
  status         LeadStatus  @default(NEW)
  createdAt      DateTime    @default(now())
  intros         Intro[]
}

model Intro {
  id            String         @id @default(cuid())
  leadRequestId String
  partnerId     String
  status        IntroStatus    @default(NEW)
  notes         String?
  createdAt     DateTime       @default(now())
  leadRequest   LeadRequest    @relation(fields: [leadRequestId], references: [id])
  partner       PartnerProfile @relation(fields: [partnerId], references: [id])
}

model CommissionRule {
  id               String              @id @default(cuid())
  scenario         CommissionScenario  @unique
  percentLeadHolder Int
  percentSeller     Int
  percentDelivery   Int
  holdbackPercent   Int
  updatedAt         DateTime @updatedAt
}
